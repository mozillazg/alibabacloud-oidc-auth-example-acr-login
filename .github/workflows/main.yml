name: 'demo'

on:
  push:
    branches:
    - master
  workflow_dispatch:

jobs:
  demo:
    name: 'demo'
    runs-on: ubuntu-latest
    permissions:
      id-token: write # This is required for requesting the JWT
    steps:
      - name: get credentials
        id: get-credentials
        uses: 'mozillazg/alibabacloud-oidc-auth@v1'
        with:
          role-arn-to-assume: '${{ secrets.ROLE_ARN }}'
          oidc-provider-arn: '${{ secrets.OIDC_ARN }}'
          set-outputs: 'true'

      # https://github.com/mozillazg/acr-login/tree/support-sts-token-update-dist
      - uses: mozillazg/acr-login@support-sts-token-update-dist
        with:
          region-id: ap-southeast-1
          access-key-id: ${{ steps.get-credentials.outputs.access-key-id }}
          access-key-secret: ${{ steps.get-credentials.outputs.access-key-secret }}
          security-token: ${{ steps.get-credentials.outputs.security-token }}
